(()=>{"use strict";class t{constructor(t){this.params=t}setTitle(t){document.title=t}render(t,e){}}class e{}e.checkId=t=>{const e=t.split("/");return 2===e.length&&Number(e.slice(-1).join(""))},e.setFilter=t=>{if(t&&t.includes("?")){const e=t.split("?")[1].replace("/",""),s={};return e.split("&").forEach((t=>{const[e,n]=t.includes("=")?t.split("="):t,r=n.split("+");s[e]=r})),s}return{}};const s=e;class n{static isValidName(t){const e=t.split(" ");return!(e.length<2)&&e.filter((t=>t.length>2)).length===e.length}static isValidPhone(t){return String(t).length>0&&/^([+ ]{2}[0-9]{9,14})?$/.test(String(t))}static isValidAddress(t){const e=t.split(" ");return!(e.length<3)&&e.filter((t=>t.length>4)).length===e.length}static isValidEmail(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}static isValidCardNumber(t){return String(t).length>0&&/^([0-9]{4}[ ]{1}[0-9]{4}[ ]{1}[0-9]{4}[ ]{1}[0-9]{4})?$/.test(String(t))&&this.isCreditCardNumber(t)}static isValidValidThru(t){const e=t.split("/");return 1!==e.length&&!(Number(e[0])>12)&&e.filter((t=>2===t.length)).length===e.length}static isValidCvv(t){return 3===t.length}static isCreditCardNumber(t){const e=t.toString().split("").filter((t=>" "!==t));return e.map(((t,s)=>{let n=Number(t);return s%2==0&&e.length%2==0||s%2&&e.length%2?2*n>9?2*n-9:2*n:Number(t)})).reduce(((t,e)=>t+e),0)%10==0}}class r{constructor(){this.root=document.getElementById("root")}listener(t){let e;document.querySelector(".buy__order").addEventListener("click",(()=>{"#cart"!==location.hash&&this.buyFromProductDetails(t),e=this.createModal();const s=document.querySelector(".form"),r=s.querySelector(".input-card-number"),a=s.querySelector(".input-valid-thru"),i=s.querySelector(".input-name"),o=s.querySelector(".input-number"),c=s.querySelector(".input-address"),l=s.querySelector(".input-email"),d=s.querySelector(".input-valid-thru"),u=s.querySelector(".input-cvv");s.addEventListener("submit",(t=>(t.preventDefault(),this.isValidForm(i,o,c,l,r,u,d)))),i&&i.addEventListener("blur",(t=>{this.validName(i)})),o&&o.addEventListener("focus",(function(t){const e=t.target.value;t.target.value=`+ ${e.replace(/[^\d.]/g,"")}`})),o&&o.addEventListener("blur",(t=>{this.validPhone(o)})),c&&c.addEventListener("blur",(t=>{this.validAddress(c)})),l&&l.addEventListener("blur",(t=>{this.validEmail(l)})),r&&r.addEventListener("blur",(t=>{this.validCardNumber(r)})),r&&r.addEventListener("input",(t=>{this.cardNumberHandler(t,r)})),d&&d.addEventListener("input",(t=>{this.validThruHandler(t,a)})),d&&d.addEventListener("blur",(()=>{this.validThru(a)})),u&&u.addEventListener("input",(t=>{this.cvvHandler(t,u)})),u&&u.addEventListener("blur",(t=>{this.validCvv(u)})),d&&d.addEventListener("blur",(()=>{n.isValidValidThru(d.value)?d.classList.remove("error"):d.classList.add("error")})),u&&u.addEventListener("blur",(()=>{n.isValidCvv(u.value)?u.classList.remove("error"):u.classList.add("error")}))})),window.addEventListener("click",(t=>{const e=t.target;"modal"===e.className&&e.remove()}))}createModal(){let t=document.createElement("div");return t.classList.add("modal"),t.innerHTML='\n<div class="modal-content">\n    <form class="form" action="" novalidate>\n        <p class="form-title personal-title">Personal Data</p>\n        <div class="form__group">\n            <input type="text" class="input input-name" name="fullName" placeholder="Name">\n            <div class="error-name">Please enter a valid name (NAME SURNAME) </div>\n        </div>\n        <div class="form__group">\n            <input type="tel" minlength="9"\n            maxlength="14" class="input input-number" name="number" placeholder="Phone number">\n            <div class="error-number">Please enter a valid phone number (phone number length minimum 9 and maximum 14). </div>\n        </div>\n        <div class="form__group">\n            <input type="text" class="input input-address" name="address" placeholder="Delivery address">\n            <div class="error-address">Please enter a valid address (address should contains at least three words no shorter than 5 characters.) </div>\n        </div>\n        <div class="form__group">\n            <input type="email" class="input input-email" name="email" placeholder="E-mail">\n            <div class="error-email">Please enter a valid email (name@test.com) </div>\n        </div>\n        <p class="form-title card-title">Card data</p>\n        <div class="form__group card-number-wrapper">\n            <input type="text" class="input input-card-number" name="card-number" placeholder="Card number">\n            <img src="./assets/bankCard.png" class="bankcard-img" width="80px" height="50px" alt="bankCard">\n             </div>\n         <div class="error-card-number">Please enter a valid payment card number. </div>\n        <div class="card-data-wrapper">\n        <div>\n        <input type="text" class="input input-valid-thru" name="valid-thru" placeholder="valid thru">\n            <div class="error-thru">MM/YY </div>\n            </div>\n            <div>\n            <input type="text" class="input input-cvv" name="cvv" placeholder="CVV">\n            <div class="error-cvv">XXX</div>\n            </div>   \n        </div>\n        <button class="sumbit-btn" type="submit">\n            Confirm\n        </button>\n    </form>\n</div>\n',this.root.after(t),t}isValidForm(t,e,s,n,r,a,i){let o=!0;if(this.validName(t),this.validPhone(e),this.validEmail(n),this.validAddress(s),this.validCardNumber(r),this.validThru(i),this.validCvv(a),o=0===document.querySelectorAll(".error").length,o){localStorage.clear();const t=document.querySelector(".modal"),e=document.querySelector(".modal-content");e.innerHTML="",e.style.top="25%",e.innerHTML='<p class="info">Thank you for your order!</p><p class="info">Our manager will contact you.</p><p class="info">You`ll be redirected to the main page.</p>',setTimeout((function(){t&&t.remove(),window.location.hash=""}),3e4)}return o}cardNumberHandler(t,e){if(t instanceof InputEvent&&!t.data)return;if(t instanceof InputEvent&&" "===t.data)return void(e.value=e.value.slice(0,-1));e.value=e.value.replace(/[^0-9\s]+/g,""),e.value.replace(/\s/g,"").length%4==0&&e.value.length>0&&(e.value+=" "),e.value.replace(/\s/g,"").length>15&&(e.value=e.value.slice(0,-1));let s=document.querySelector(".bankcard-img");4===Number(e.value[0])?s.src="./assets/visa.png":5===Number(e.value[0])?s.src="./assets/masterCard.png":6===Number(e.value[0])?s.src="./assets/maestro.png":s.src="./assets/bankCard.png"}validEmail(t){n.isValidEmail(t.value)?(t.classList.remove("error"),document.querySelector(".error-email").classList.remove("show")):(t.classList.add("error"),document.querySelector(".error-email").classList.add("show"))}validPhone(t){n.isValidPhone(t.value)?(t.classList.remove("error"),document.querySelector(".error-number").classList.remove("show")):(t.classList.add("error"),document.querySelector(".error-number").classList.add("show"))}validName(t){n.isValidName(t.value)?(t.classList.remove("error"),document.querySelector(".error-name").classList.remove("show")):(t.classList.add("error"),document.querySelector(".error-name").classList.add("show"))}validAddress(t){n.isValidAddress(t.value)?(t.classList.remove("error"),document.querySelector(".error-address").classList.remove("show")):(t.classList.add("error"),document.querySelector(".error-address").classList.add("show"))}validCardNumber(t){n.isValidCardNumber(t.value)?(t.classList.remove("error"),document.querySelector(".error-card-number").classList.remove("show")):(t.classList.add("error"),document.querySelector(".error-card-number").classList.add("show"))}validThru(t){n.isValidValidThru(t.value)?(t.classList.remove("error"),document.querySelector(".error-thru").classList.remove("show")):(t.classList.add("error"),document.querySelector(".error-thru").classList.add("show"))}validCvv(t){n.isValidCvv(t.value)?(t.classList.remove("error"),document.querySelector(".error-cvv").classList.remove("show")):(t.classList.add("error"),document.querySelector(".error-cvv").classList.add("show"))}validThruHandler(t,e){t instanceof InputEvent&&!t.data||(t instanceof InputEvent&&("/"===t.data||" "===t.data)?e.value=e.value.slice(0,-1):(e.value=e.value.replace(/[^0-9\/]+/g,""),e.value.replace(/\//g,"").length%2==0&&e.value.length>0&&(e.value+="/"),e.value.replace(/\//g,"").length>3&&(e.value=e.value.slice(0,-1))))}cvvHandler(t,e){t instanceof InputEvent&&!t.data||(e.value=e.value.replace(/[^0-9]+/g,""),e.value.length>3&&(e.value=e.value.slice(0,-1)))}buyFromProductDetails(t){const e=location.hash.split("/").slice(-1)[0];window.location.hash="#cart";const s=localStorage.getItem("cart"),n=s?JSON.parse(s):{};if(!n.inCart||n.inCart&&!n.inCart.map((t=>t.id)).includes(Number(e))){const s=n.inCart?n.inCart:[];if(t){const n=t.find((t=>t.id===Number(e)));if(n){n.count=1,s.push(n);const t=JSON.stringify({inCart:s});localStorage.setItem("cart",t)}}}}}const a={rss:10,epam:15,develop:10};class i{constructor(){this.couponInput=document.querySelector(".coupon"),this.appliedPromo=new Set(JSON.parse(localStorage.getItem("coupons"))||[])}listener(){this.createList(),this.couponInput.addEventListener("input",(()=>{for(let t in a)this.couponInput.value.toLowerCase()===t?this.createPromo(t):this.deletePromo(t)}))}createPromo(t){let e=document.createElement("div"),s=document.createElement("div"),n=document.createElement("button");e.classList.add("wrapper"),s.classList.add("find-promo"),n.classList.add("apply-promo"),s.textContent=`${t} - ${a[t]}%`,n.textContent="add",n.addEventListener("click",(()=>{this.appliedPromo.add(t);let e=JSON.parse(localStorage.getItem("coupons"))||[];e.push(t),localStorage.setItem("coupons",JSON.stringify(e)),this.createList()})),e.append(s,n);const r=document.querySelector(".find-coupon");r&&r.append(e)}deletePromo(t){let e=document.querySelector(".find-coupon").querySelector(".find-promo");e&&e.textContent.startsWith(t)&&e.closest(".wrapper").remove()}createList(){let t=document.querySelector(".applied-coupons"),e=document.createElement("div");e.classList.add("promos");let s=document.createElement("div");t.innerHTML="",this.appliedPromo.size>0&&(s.classList.add("applied-promo-title"),s.textContent="Applied promo",t.append(s)),Array.from(this.appliedPromo).forEach((t=>{let s=document.createElement("div"),n=document.createElement("div"),r=document.createElement("button");s.classList.add("promo-drop__wrapper"),n.classList.add("promo"),r.classList.add("drop"),n.textContent=`${t} - ${a[t]}%`,r.textContent="drop",r.addEventListener("click",(()=>{this.appliedPromo.delete(t);let e=(JSON.parse(localStorage.getItem("coupons"))||[]).filter((e=>e!==t));localStorage.setItem("coupons",JSON.stringify(e)),this.createList()})),s.append(n,r),e.append(s)})),t.append(e),this.setNewPrice()}setNewPrice(){const t=document.querySelector(".discount-price"),e=document.querySelector(".buy__total-amount");if(this.appliedPromo.size){e.classList.add("crossOut");const s=Array.from(this.appliedPromo).reduce(((t,e)=>t+a[e]),0);t.textContent=`Total:   $ ${(+e.textContent.slice(2)*(1-s/100)).toFixed(2)}`}else t.innerHTML="",e.classList.remove("crossOut")}}class o extends t{constructor(t){super(t),this.params=t,this.setTitle("Basket"),this.cart=new l}fillCartList(){const t=this.cart.getCart(),e=document.querySelector(".order");if(t&&t.length>0){this.cart.pagination();const s=document.querySelector("#limit"),n=s?Number(s.value):4,r=document.querySelector(".pagination .active"),a=r?Number(r.textContent):1,i=a>1?n*a-n:0;let o=a*n-n;const c=i+n,l=t.slice(i,c);this.cart.setCurrentAmountHeader();const d=document.querySelector(".basket-list");e&&e.classList.remove("hidden");const u=l.map(((t,e)=>`<li class="basket-list-item">\n          <div  class="basket-item-container">\n          <div class="basket-item-number">\n          <p >${a>1?++o:e+1}.</p></div>\n           <div id=${t.id}  class = "basket-item-photo" style = background-image:url('${t.thumbnail}') ></div>\n            <div class="basket-item-description">\n              <p>${t.title} (${t.category[0].toUpperCase()+t.category.slice(1,t.category.length)})</p>\n              <p>${t.description}</p>\n              <p>Rating: ${t.rating}</p>\n            </div>\n            <div class="basket-item-price" >\n              <p>$ ${t.price}.00</p>\n            </div>\n            <div id =${t.id} class="basket-item-count">\n              <button class="basket-item-add">+</button>\n            <div class="item-count-info">\n              <p class="basket-item-stock">Stock: ${t.stock}</p>\n              <p>${t.count}</p>\n            </div>  \n              <button class="basket-item-remove">-</button>\n            </div>\n            <div class="basket-item-total">\n              <p>$${t.count?t.count*t.price:0}.00</p>\n            </div>\n          </div>\n        </li>`));d&&u.length>0&&(d.innerHTML=u.reduce(((t,e)=>t+e)))}else{const t=document.querySelector(".basket-products"),s=document.createElement("div");s.classList.add("basket-empty"),s.textContent="Cart is empty",t&&(t.innerHTML="",t.append(s)),e&&e.classList.add("hidden")}this.cart.listenCount(),this.cart.listenCardDetails()}render(t,e){t.innerHTML='\n<section class="basket-page">\n    <div class="container">\n        <h2 class="basket__title">Cart</h2>\n        <div class="pagination-wrapper">\n        <div class="pagination-limit"></div>\n        <div class="pagination"></div>\n        </div>\n        <div class="basket-products">\n        <div class="basket-products__name"><h4>Product</h4></div>\n        <div class="basket-products__price"><h4>Price</h4></div>\n        <div class="basket-products__amount"><h4>Amount</h4></div>\n        <div class="basket-products__total"><h4>Total</h4></div>\n        </div>\n        <div ><ul class="basket-list"></ul></div>\n        <div class="order">\n            <div class="coupon__wrapper">\n               <input type="text" class="coupon" placeholder="promo code (rss, epam)">\n               <div class="find-coupon"></div>\n               <div class="applied-coupons"></div>\n            </div>\n            <div class="buy__wrapper">\n              <div class="buy__total"><div><p class="basket-amount"></p>\n            </div>\n                  <p>Total:&nbsp;&nbsp;</p>\n                    <p class="buy__total-amount"></p>\n                    <div class="discount-price"></div>\n                </div>\n                <button class="buy__order">BUY NOW</button>\n            </div>\n        <div>\n    </div>\n<section>',this.fillCartList(),this.afterRootRender(e)}afterRootRender(t){const e=new r;t?e.listener(t.products):e.listener(),(new i).listener()}}const c=class{constructor(t){this.store=t,this.obj=this.getAll()}set(t,e){const s=this.obj;s[t]=e;const n=JSON.stringify(s);localStorage.setItem(this.store,n)}get(t){return this.obj[t]}drop(t){this.obj[t]&&this.obj[t].length>0?this.obj[t].length=0:this.obj[t];const e=this.obj,s=JSON.stringify(e);localStorage.setItem(this.store,s)}getAll(){const t=localStorage.getItem(this.store);return t?JSON.parse(t):{}}dropAll(){localStorage.clear()}};class l{constructor(){this.storage=new c("cart"),this.cartData=this.storage.get("inCart")||[]}listenCart(t){this.setCurrentAmountHeader();const e=document.querySelector(".products-items"),s=document.querySelector(".product-wrapper"),n=e||s;n&&n.addEventListener("click",(e=>{this.cartData=this.storage.get("inCart")||[];const s=e.target instanceof HTMLElement?Number(e.target.id):"",n=t.find((t=>t.id===s));if(n&&e.target instanceof HTMLElement&&"card__buttons-add"===e.target.className)n.count=1,this.cartData.push(n),this.storage.set("inCart",this.cartData),this.toggleButton(e.target,e.target.id,"Remove from cart");else if(e.target instanceof HTMLButtonElement&&"card__buttons-remove"===e.target.className&&n){n.count=0;const t=e.target.id,s=this.cartData.filter((e=>String(e.id)!==t));this.storage.set("inCart",s),this.toggleButton(e.target,e.target.id,"Add to cart")}this.setCurrentAmountHeader()}))}listenCount(){const t=document.querySelector(".basket-list");t&&t.addEventListener("click",(t=>{if(t.target instanceof HTMLElement&&t.target.classList.contains("basket-item-add")){const e=t.target.closest("div");if(e){const t=Number(e.id);this.cartData.forEach((e=>e.id===t&&e.count&&e.stock>=e.count+1?e.count+=1:e))}this.storage.set("inCart",this.cartData)}else if(t.target instanceof HTMLElement&&t.target.classList.contains("basket-item-remove")){const e=t.target.closest("div");if(e){const t=Number(e.id);this.cartData.forEach((e=>{if(e.id===t&&e.count&&e.count>1)e.count-=1,this.storage.set("inCart",this.cartData);else if(e.id===t&&1===e.count){const t=this.cartData.filter((t=>t.id!==e.id));this.storage.set("inCart",t)}}))}}const e=new o("#cart"),s=document.querySelector("#root");s&&e.render(s)}));const e=document.querySelector(".buy__total-amount");e&&(e.textContent=`$ ${this.getTotalAmount()}.00`),this.setCurrentAmountHeader()}setCurrentAmountHeader(){const t=this.getTotalAmount()||0,e=document.querySelector("#totalAmount");e&&(e.textContent=t?`Total: $ ${t}`:"Total: $ 0"),this.setProductsInCart()}setProductsInCart(){const t=document.querySelector(".basket-count"),e=document.querySelector(".basket-amount"),s=this.cartData&&this.cartData.length>0?this.cartData.map((t=>t.count)).reduce(((t,e)=>{if(t&&e)return t+e})):0;s&&s>0&&t?(t.style.display="block",t.textContent=`${s}`,e&&(e.textContent=`Products: ${s}`)):t&&(t.style.display="none")}listenCardDetails(){const t=document.querySelector(".basket-list");t&&t.addEventListener("click",(t=>{if(t.target instanceof HTMLElement&&t.target.classList.contains("basket-item-photo")){const e=t.target.id;window.location.hash=`#product-details/${e}`}}))}getTotalAmount(){return this.cartData=this.storage.get("inCart")||[],this.cartData&&this.cartData.length>0?this.cartData.map((t=>{if(t.count)return t.price*t.count})).reduce(((t,e)=>{if(t&&e)return t+e})):0}getCart(){return this.storage.get("inCart")?this.storage.get("inCart"):[]}toggleButton(t,e,s){const n=document.querySelector(`.card__item.id-${e}`);t.textContent=`${s}`,t.classList.toggle("card__buttons-remove"),t.classList.toggle("card__buttons-add"),n&&n.classList.toggle("in-cart")}pagination(){const t=this.storage.get("limit")&&this.storage.get("limit")[0]?this.storage.get("limit")[0]:4;let e=this.storage.get("page")&&this.storage.get("page")[0]?this.storage.get("page")[0]:1;const n=document.querySelector(".pagination-limit");n&&(n.innerHTML='<label for="limit">Limit: </label>\n        <input id="limit" type="number" value="4" min="1"/>');const r=document.querySelector("#limit"),a=document.querySelector(".pagination");if(r&&a){r.value=`${t}`;const n=this.getCart().length,i=r.value,o=Math.ceil(n/Number(i));o<e&&(e=String(o),this.storage.set("page",[e]));let c="";for(let t=0;t<o;t++)c+=`<div id="page${t+1}">${t+1}</div>`;a.innerHTML=c;const l=e>1?'<div class="prev"><</div>':'<div class="prev0"><</div>',d=e<o?'<div class="next">></div> ':'<div class="next-last">></div>';a.insertAdjacentHTML("afterbegin",l),a.insertAdjacentHTML("beforeend",d);const u=a.querySelector(`#page${e}`);u&&u.classList.add("active"),a.addEventListener("click",(t=>{if(t.target instanceof HTMLElement&&!t.target.classList.contains("prev0")&&!t.target.classList.contains("next-last"))if(t.target.id){a.querySelectorAll("div").forEach((t=>t.classList.remove("active"))),t.target.classList.add("active");const e=t.target.textContent||"";this.checkPage(e)}else if(t.target.classList.contains("prev")){const t=Number(e)-1;this.checkPage(String(t))}else if(t.target.classList.contains("next")){const t=Number(e)+1;this.checkPage(String(t))}})),r.addEventListener("input",(t=>{if(t.target instanceof HTMLInputElement){this.storage.set("limit",[t.target.value]);const e=s.setFilter(location.hash),n=location.hash.includes("page")?`page=${e.page[0]}&`:"";window.location.hash=`#cart/?${n}limit=${t.target.value}`}}))}}checkPage(t){const e=s.setFilter(location.hash);this.storage.set("page",[t]);const n=location.hash.includes("limit")?`limit=${e.limit[0]}&`:"";window.location.hash=`#cart/?${n}page=${t}`}clearStorage(){["limit","page"].forEach((t=>this.storage.drop(t)))}}class d{listenPhoto(){const t=document.querySelector(".img-choose"),e=document.querySelector(".img-main"),s=document.querySelectorAll(".img-choose img");t&&t.addEventListener("click",(t=>{if(t.target instanceof HTMLImageElement&&"IMG"===t.target.tagName&&e){const n=t.target.src;e.src=n,s.forEach((t=>t.classList.remove("active"))),t.target.classList.add("active")}}))}}class u extends t{constructor(t){super(t),this.params=t,this.setTitle("Product Details"),this.productsView=new class{draw(t){const e=localStorage.getItem("cart");let s={};e&&(s=JSON.parse(e));const n=(s&&s.inCart?s.inCart:[]).map((t=>t.id)),r=document.createDocumentFragment(),a=document.querySelector("#productDetails");if(1===t.length&&a instanceof HTMLTemplateElement){const e=t[0],s=a.content.cloneNode(!0),i=s.querySelector(".crumb-category");i&&(i.textContent=e.category,i.href=`#?/category=${e.category.toLowerCase()}`);const o=s.querySelector(".crumb-brand");o&&(o.textContent=e.brand,o.href=`#?/brand=${e.brand.toLowerCase()}`);const c=s.querySelector(".crumb-title");c&&(c.textContent=e.title);const l=s.querySelector(".product-item");l&&(l.textContent=e.title);const d=s.querySelector(".img-one");d&&(d.src=e.thumbnail);const u=s.querySelector(".img-two");u&&(1===e.id?u.src=e.images[3]:u.src=e.images[1]);const h=s.querySelector(".img-three");h&&(h.src=e.images[2]);const m=s.querySelector(".img-main");m&&(m.src=e.thumbnail);const p=s.querySelector(".product-description-text");p&&(p.textContent=e.description);const v=s.querySelector(".product-rating-value");v&&(v.textContent=`${e.rating}`);const g=s.querySelector(".product-stock-value");g&&(g.textContent=`${e.stock}`);const b=s.querySelector(".product-brand-value");b&&(b.textContent=e.brand);const y=s.querySelector(".product-category-value");y&&(y.textContent=e.category);const f=s.querySelector(".product-price");f&&(f.textContent=`Price: $${e.price}.00`);const S=s.querySelector(".card__buttons-add");return S&&(S.id=`${e.id}`),n.includes(e.id)&&S&&(S.classList.remove("card__buttons-add"),S.classList.add("card__buttons-remove"),S.textContent="Remove from cart"),r.append(s),r}return null}},this.cart=new l,this.modalWindow=new r,this.photo=new d}showIncorrect(){const t=document.createElement("div");return t.classList.add("not-found"),t.textContent=`Product number\n  ${this.params.split("/").slice(-1).join("")}\n    not found`,t}getItem(t){const e=s.checkId(this.params);if(e){const s=t.products.filter((t=>t.id===e));return s.length>0?this.productsView.draw(s):null}return null}afterRootRender(t){const e=this.getItem(t),s=document.querySelector(".product-details");s&&(e?(s.append(e),this.cart.listenCart(t.products),this.modalWindow.listener(t.products),this.photo.listenPhoto()):s.append(this.showIncorrect()))}render(t,e){t.innerHTML='<div class="product-details container"></div>',this.afterRootRender(e)}}const h=class extends t{constructor(t){super(t)}afterRootRender(){}render(t){const e=document.createElement("div");e.classList.add("error-page");const s=document.createElement("div");s.textContent="404",e.append(s),t.append(e)}};class m{constructor(){this.currentFilters=s.setFilter(location.hash)}listen(t){this.listenSort(),this.listenFound(t),this.listenView()}listenSort(){const t=document.getElementById("input"),e=this.currentFilters.sort?this.currentFilters.sort[0]:"";if(e){const s=document.querySelector(`#${e}`);if(s&&s.classList.add("selected"),t instanceof HTMLInputElement){const s=document.querySelector(`#${e}.selected`);if(s){const e=s.textContent;e&&(t.value=e)}}}const s=document.querySelector(".sort-bar"),n=document.querySelector(".select"),r=document.querySelectorAll(".sort-bar .option"),a=document.querySelector("#root");let i="";n&&s&&a&&(n.addEventListener("click",(()=>{s.classList.add("active")})),s.addEventListener("click",(e=>{if(e.target instanceof HTMLElement){const n=e.target.closest("div");if(e.target.classList.contains("option")||n&&n.classList.contains("option")){const n=e.target.closest("div");r.forEach((e=>{if(e.classList.remove("selected"),n&&t instanceof HTMLInputElement){n.classList.add("selected");const e=n.children[0].textContent;e&&(t.value=e)}s.classList.remove("active")})),n&&(i=n.id),this.changeHash("sort",i)}}})),a.addEventListener("click",(t=>{const e=document.querySelector(".sort-bar.active");if(t.target instanceof HTMLElement){const n=t.target.closest("div");n&&!n.classList.contains("select")&&e&&s.classList.remove("active")}})))}changeHash(t,e){const s=location.hash;if(s&&s.slice(3,7)!==`${t}`){const n=e.length>0?`&${t}=${e}`:"";window.location.hash=`${s.split("&").filter((e=>e.slice(0,4)!==`${t}`)).join("&")}${n}`}else e.length>0?window.location.hash=`#?/${t}=${e}`:window.location.hash=""}listenFound(t){const e=document.querySelector(".stat-count");e&&(e.textContent=`${t}`)}listenView(){const t=document.querySelector(".view-mode"),e=document.querySelector(".products-items"),s=this.currentFilters.view?this.currentFilters.view[0]:"";if(s){const t=document.querySelector(".view-mode .active");t&&t.classList.remove("active");const n=document.querySelector(`.${s}`);n&&n.classList.add("active"),e&&("two"===s?e.classList.add("big"):e.classList.remove("big"))}t&&t.addEventListener("click",(t=>{if(t.target instanceof HTMLElement)if(t.target.classList.contains("active"))this.changeHash("view",t.target.classList[0]);else{const s=document.querySelector(".view-mode .active");s&&s.classList.remove("active"),t.target.classList.add("active"),e&&(t.target.classList.contains("two")?e.classList.add("big"):e.classList.remove("big")),this.changeHash("view",t.target.classList[0])}}))}}class p{changeHash(t,e){const s=location.hash;if(s&&"price"!==s.slice(3,8)){const n=`&price=${t.toString()}+${e.toString()}`;window.location.hash=`${s.split("&").filter((t=>"price"!==t.slice(0,5))).join("&")}${n}`}else window.location.hash=`#?/price=${t.toString()}+${e.toString()}`;this.validateRange(t,e)}validateRange(t,e){const s=document.querySelector(".min-price"),n=document.querySelector(".max-price"),r=document.getElementById("min-value-price"),a=document.getElementById("max-value-price");s&&n&&r&&a&&(t===1/0||t===-1/0?(r.innerHTML="—",a.innerHTML="—"):(r.innerHTML="$"+t,a.innerHTML="$"+e),s.value=`${t}`,n.value=`${e}`)}listenPrice(t,e){this.validateRange(t,e);const s=document.querySelectorAll('#price input[type="range"]');s.forEach((t=>{t.addEventListener("change",(t=>{const e=parseInt(s[0].value)<parseInt(s[1].value)?parseInt(s[0].value):parseInt(s[1].value),n=parseInt(s[0].value)>parseInt(s[1].value)?parseInt(s[0].value):parseInt(s[1].value);this.changeHash(e,n)})),t.addEventListener("input",(t=>{const e=parseInt(s[0].value)<parseInt(s[1].value)?parseInt(s[0].value):parseInt(s[1].value),n=parseInt(s[0].value)>parseInt(s[1].value)?parseInt(s[0].value):parseInt(s[1].value);this.changeHash(e,n)}))}))}}class v{listenSearch(){const t=s.setFilter(location.hash),e=document.querySelector(".search__input");t.search&&e&&(e.value=t.search[0]),e&&e.addEventListener("input",(t=>{t.preventDefault(),t.target instanceof HTMLInputElement&&this.changeHash(t.target.value.toLowerCase())}))}changeHash(t){const e=location.hash;if(e&&"search"!==e.slice(3,9)){const s=t.length>0?`&search=${t}`:"";window.location.hash=`${e.split("&").filter((t=>"search"!==t.slice(0,6))).join("&")}${s}`}else t.length>0?window.location.hash=`#?/search=${t}`:window.location.hash=""}}class g{changeHash(t,e){const s=location.hash;if(s&&"stock"!==s.slice(3,8)){const n=`&stock=${t.toString()}+${e.toString()}`;window.location.hash=`${s.split("&").filter((t=>"stock"!==t.slice(0,5))).join("&")}${n}`}else window.location.hash=`#?/stock=${t.toString()}+${e.toString()}`;this.validateRange(t,e)}validateRange(t,e){const s=document.querySelector(".min-stock"),n=document.querySelector(".max-stock"),r=document.getElementById("min-value-stock"),a=document.getElementById("max-value-stock");r&&a&&s&&n&&(t===1/0||t===-1/0?(r.innerHTML="—",a.innerHTML="—"):(r.innerHTML=`${t}`,a.innerHTML=`${e}`),s.value=`${t}`,n.value=`${e}`)}listenStock(t,e){this.validateRange(t,e);const s=document.querySelectorAll('#stock input[type="range"]');s.forEach((t=>{t.addEventListener("change",(t=>{const e=parseInt(s[0].value)<parseInt(s[1].value)?parseInt(s[0].value):parseInt(s[1].value),n=parseInt(s[0].value)>parseInt(s[1].value)?parseInt(s[0].value):parseInt(s[1].value);this.changeHash(e,n)})),t.addEventListener("input",(t=>{const e=parseInt(s[0].value)<parseInt(s[1].value)?parseInt(s[0].value):parseInt(s[1].value),n=parseInt(s[0].value)>parseInt(s[1].value)?parseInt(s[0].value):parseInt(s[1].value);this.changeHash(e,n)}))}))}}class b{listen(){const t=document.querySelector(".copy");t&&t.addEventListener("click",(()=>{let e=document.createElement("input");t.textContent="Copied!",setTimeout((()=>{t.textContent="Copy link"}),600),e.value=window.location.href,t.parentNode&&(t.parentNode.appendChild(e),e.select(),document.execCommand("copy"),e.parentNode&&e.parentNode.removeChild(e))}))}}class y{static directSort(t,e){return t.sort(((t,s)=>Number(t[e])-Number(s[e])))}static reverseSort(t,e){return t.sort(((t,s)=>Number(s[e])-Number(t[e])))}}class f extends t{constructor(t){super(t),this.setTitle("Home"),this.productsView=new class{draw(t){const e=t,s=localStorage.getItem("cart");let n={};s&&(n=JSON.parse(s));const r=(n&&n.inCart?n.inCart:[]).map((t=>t.id)),a=document.createDocumentFragment(),i=document.querySelector("#cardTemplate");return e.length>0&&i?(e.forEach(((t,e)=>{const s=i.content.cloneNode(!0);s.children[0].classList.add(`id-${t.id}`);const n=s.querySelector(".card__body-photo");n&&(n.src=t.thumbnail);const o=s.querySelector(".card__body-title");o&&(o.textContent=t.title);const c=s.querySelector(".list__item-brand");c&&(c.textContent=`${t.brand}`);const l=s.querySelector(".list__item-price");l&&(l.textContent=`${t.price} $`);const d=s.querySelector(".list__item-rating");d&&(d.innerHTML=`Rating: <strong>${t.rating}</strong>`);const u=s.querySelector(".card__buttons-add");u&&(u.id=`${t.id}`);const h=s.querySelector(".card__link-details");if(h&&(h.href=`#product-details/${t.id}`),r.includes(t.id)){s.children[0].classList.add("in-cart");const t=s.querySelector(".card__buttons-add");t&&(t.classList.remove("card__buttons-add"),t.classList.add("card__buttons-remove"),t.textContent="Remove from cart")}a.append(s)})),a):null}},this.listener=new class{constructor(){this.listenDynamicData=(t,e,s,n,r)=>{this.price.listenPrice(t,e),this.stock.listenStock(s,n),this.sort.listen(r)},this.search=new v,this.price=new p,this.stock=new g,this.sort=new m,this.filters=new class{constructor(){this.listen=()=>{this.addChecked();const t=document.querySelector(".filters__box");t&&t.addEventListener("change",(t=>{if(t.target instanceof HTMLInputElement&&this.filters.includes(t.target.name)){const e=document.querySelectorAll(`[name=${t.target.name}]:checked`),s=[];e.forEach((t=>{s.push(t.value)})),this.storage.set(`${t.target.name}`,s);const n=this.storage.getAll();let r="#?/";const a=window.location.hash,i=a.slice(3,a.length).split("&").filter((t=>"price"===t.slice(0,5)||"stock"===t.slice(0,5)||"search"===t.slice(0,6)||"view"===t.slice(0,4)||"sort"===t.slice(0,4)));this.filters.forEach(((t,e)=>{n[t]&&n[t].length>0&&(r+=`${e>0&&r.length>3?"&":""}${t}=${n[t].join("+")}`)})),i.forEach((t=>r+=`&${t}`)),"&"===r[3]&&(r=r.replace("&","")),window.location.hash=3===r.length?"":r}}));const e=document.querySelector("#remove");e&&e.addEventListener("click",(t=>{if(t.target instanceof HTMLElement){const e=t.target.closest("div");e&&"remove"===e.id&&(this.clearFilters(),window.location.hash="")}}))},this.addChecked=()=>{let t=s.setFilter(location.hash);this.filters.forEach((e=>{t[e]&&document.querySelectorAll(`[name=${e}]`).forEach((s=>{t[e].includes(s.value)&&(s.checked=!0)}))}))},this.filters=["category","brand","price","stock"],this.storage=new c("shop")}clearFilters(){this.filters.forEach((t=>this.storage.drop(t))),document.querySelectorAll('[type="checkbox"]:checked').forEach((t=>t.checked=!1))}},this.cart=new l,this.copyUrl=new b}listenStaticData(t){this.filters.listen(),this.search.listenSearch(),this.cart.listenCart(t),this.copyUrl.listen(),location.hash.length<1&&this.clearFilters()}clearFilters(){this.filters.clearFilters()}},this.currentFilters=s.setFilter(this.params),this.cart=new l,this.minPrice=0,this.maxPrice=0,this.minStock=0,this.maxStock=0}getCategoryProducts(t){let e=Object.keys(this.currentFilters),s=t;return e.forEach((t=>{s=s.filter((e=>"price"===t&&null!=this.currentFilters[t]?(this.minPrice=Number(this.currentFilters[t][0]),this.maxPrice=Number(this.currentFilters[t][1]),e.price>=Number(this.currentFilters[t][0])&&e.price<=Number(this.currentFilters[t][1])):"stock"===t?(this.minStock=Number(this.currentFilters[t][0]),this.maxStock=Number(this.currentFilters[t][1]),e.stock>=Number(this.currentFilters[t][0])&&e.stock<=Number(this.currentFilters[t][1])):"search"===t?e.title.toLowerCase().includes(String(this.currentFilters[t][0]))||e.description.toLowerCase().includes(String(this.currentFilters[t][0]))||String(e.price)===this.currentFilters[t][0]||String(e.count)===this.currentFilters[t][0]:"sort"===t||"view"===t?e:"brand"===t?this.currentFilters[t].includes(e[t].split(" ").join("-").toLowerCase()):"category"===t?this.currentFilters[t].includes(e[t]):void 0)),"sort"===t&&this.sortData(s)})),s}afterRootRender(t){this.cart.clearStorage();const e=this.getCategoryProducts(t.products),s=this.productsView.draw(e),n=document.querySelector(".products-items");if(s)n&&n.append(s);else{const t=document.createElement("div");t.classList.add("not__found"),n&&n.append(t)}const r=Math.max(...e.map((t=>t.price))),a=Math.min(...e.map((t=>t.price))),i=Math.max(...e.map((t=>t.stock))),o=Math.min(...e.map((t=>t.stock)));this.listener.listenDynamicData(this.minPrice?this.minPrice:a,this.maxPrice?this.maxPrice:r,this.minStock?this.minStock:o,this.maxStock?this.maxStock:i,e.length)}render(t,e){const s=new Set(e.products.map((t=>t.category))),n=new Set(e.products.map((t=>t.brand.toLowerCase())));t.innerHTML='<section class="products container">\n<aside class="products__filter">\n  <div class="filters__box">\n  <div>\n   <h3>Category</h3>\n    <div id="category">\n       </div>\n    </div>\n    <div>\n      <h3>Brand</h3>\n       <div id="brand">\n        </div>\n    </div>\n      <div id="price">\n      <h3>Price</h3>\n      <div class="price__content">\n        <div class="value-field">\n          <label class="price__content-label">Min:</label>\n          <p id="min-value-price">$0</p>\n        </div>\n        <div class="value-field">\n          <label class="price__content-label">Max:</label>\n          <p id="max-value-price">$1749</p>\n        </div>\n      </div>\n      <div class="range-slider">\n        <input\n          type="range"\n          class="min-price"\n          value="0"\n          min="0"\n          max="1749"\n          step="1"\n        />\n        <input type="range" class="max-price" value="0 min="0" max="1749"\n        step="1">\n      </div>\n    </div>\n    <div id="stock">\n      <h3>Stock</h3>\n      <div class="stock__content">\n        <div class="value-field">\n          <label class="stock__content-label">Min:</label>\n          <p id="min-value-stock">0</p>\n        </div>\n\n        <div class="value-field">\n          <label class="stock__content-label">Max:</label>\n          <p id="max-value-stock">0</p>\n        </div>\n      </div>\n      <div class="range-slider">\n        <input\n          type="range"\n          class="min-stock"\n          value="0"\n          min="0"\n          max="150"\n          step="1"\n        />\n        <input type="range" class="max-stock" value="0 min="0" max="150"\n        step="1">\n      </div>\n      <div id="remove">\n        <button class="filters__box-remove">Remove all filters</button>\n      </div>\n      <div class="copy__wrapper">\n        <button class="copy">Copy link</button>\n      </div>\n    </div>\n  </div>\n</aside>\n<div class="products__wrapper">\n<div class="sort-products">  \n<div class="sort-bar">\n<div class="select">\n<input type="select-text" id="input" readonly placeholder="Sort options">\n</div>\n<div class="option-container">\n<div class="option" id = "price-ASC">\n    <label > Sort by price ASC </label>\n</div>\n<div class="option" id = "price-DESC">\n    <label>Sort by price DESC</label>\n</div>\n<div class="option" id = "rating-ASC">\n    <label>Sort by rating ASC</label>\n</div>\n<div class="option" id = "rating-DESC">\n    <label>Sort by rating DESC</label>\n</div>\n\n</div>\n</div>\n\n<div class="stat"><p>Found:&nbsp;&nbsp;</p><p class="stat-count">4</p></div>\n<div class="search-bar">\n<input class="search__input" type="search" placeholder="Search.." />\n</div>\n<div class="view-mode">\n<div class="three active"></div><div class="two"></div></div>\n</div>\n <div class="products-items"></div>\n</div>\n</section>\n',this.renderFilterData(s,n),this.listener.listenStaticData(e.products),this.afterRootRender(e)}renderFilterData(t,e){const s=document.querySelector("#category"),n=document.querySelector("#brand");t.forEach((t=>{const e=document.createElement("div");e.innerHTML=`\n  <input\n    type="checkbox"\n    id=${t.toLowerCase()}\n    name="category"\n    value=${t.toLowerCase()}\n  /><label class="filters__box-label" for=${t.toLowerCase()}\n    >${t[0].toUpperCase()+t.slice(1,t.length).toLowerCase()}</label>`,s&&s.append(e)})),e.forEach((t=>{const e=document.createElement("div");e.innerHTML=`\n  <input\n    type="checkbox"\n    id=${t.toLowerCase()}\n    name="brand"\n    value=${t.split(" ").join("-")}\n  /><label class="filters__box-label" for=${t.toLowerCase()}\n    >${t[0].toUpperCase()+t.slice(1,t.length).toLowerCase()}</label>`,n&&n.append(e)}))}sortData(t){switch(this.currentFilters.sort[0]){case"price-asc":t=y.directSort(t,"price");break;case"price-desc":t=y.reverseSort(t,"price");break;case"rating-asc":t=y.directSort(t,"rating");break;case"rating-desc":t=y.reverseSort(t,"rating")}}}class S{static getData(t){return e=this,s=void 0,r=function*(){const e=yield fetch(t);return yield e.json()},new((n=void 0)||(n=Promise))((function(t,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function o(t){try{c(r.throw(t))}catch(t){a(t)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(t){t(s)}))).then(i,o)}c((r=r.apply(e,s||[])).next())}));var e,s,n,r}}class L{static listener(){const t=document.querySelector("header");t&&t.addEventListener("click",(t=>{t.target instanceof HTMLElement&&(t.target.classList.contains("basket")&&(window.location.hash="#cart"),t.target.classList.contains("logo")&&(window.location.hash=""))}))}}(new class{start(){const t=new class{constructor(){this.root=document.querySelector("#root")}router(){return t=this,e=void 0,n=function*(){const t=[{path:"/",view:f},{path:"#product-details",view:u},{path:"#?",view:f},{path:"#cart",view:o}],e=S.getData("https://dummyjson.com/products?limit=100"),s=yield e,n=location.hash.toLocaleLowerCase()||"/",r=(()=>{if("/"===n)return 0;{const e=n.split("/").slice(0,1).join("");let s;return t.forEach(((t,n)=>{t.path.startsWith(e)&&(s=n)})),s}})(),a=document.querySelector(".products-items"),i=void 0!==r&&r>=0?new t[r].view(n):new h(n);(0===r||2===r)&&n.length>3&&a&&s.products.length>0?(a.innerHTML="",i.afterRootRender(s)):this.root&&s.products.length>0&&(this.root.innerHTML="",i.render(this.root,s))},new((s=void 0)||(s=Promise))((function(r,a){function i(t){try{c(n.next(t))}catch(t){a(t)}}function o(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(i,o)}c((n=n.apply(t,e||[])).next())}));var t,e,s,n}navigateTo(t){history.pushState(null,"",t),this.router()}};window.addEventListener("popstate",t.router),document.addEventListener("DOMContentLoaded",(()=>{document.body.addEventListener("click",(e=>{const{target:s}=e;s instanceof HTMLLinkElement&&s.matches("[data-link]")&&(e.preventDefault(),t.navigateTo(s.href))})),t.router(),L.listener()}))}}).start()})();
//# sourceMappingURL=index.js.map